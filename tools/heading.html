<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../paper-button/paper-button.html">
<link rel="import" href="../../iron-icons/editor-icons.html">
<link rel="import" href="../../iron-a11y-keys/iron-a11y-keys.html">
<link rel="import" href="../../paper-tooltip/paper-tooltip.html">
<link rel="import" href="../../font-roboto/roboto.html">
<link rel="import" href="../wysiwyg-tool-behavior.html">
<link rel="import" href="../wysiwyg-tool-styles.html">
<dom-module id="wysiwyg-tool-heading">
	<template>
		<style include="wysiwyg-tool-styles"></style>
		<style>
			:host {
				font-family: Roboto;
			}

		  paper-button {
		    padding: 0;
		    margin: 0;
        height: 40px;
        line-height: 40px;
        border-radius: 0px;
        min-width: 40px;
        background: transparent;
        text-transform: none;
				font-weight: bold;
				font-size: 18px;
		  }

			paper-button[disabled] {
				color: inherit;
			}
		</style>
		<paper-button disabled="[[disabled]]" id="button">H[[level]]</paper-button>
		<paper-tooltip id="tooltip" for="button">[[modifier.tooltip]] + [[level]]</paper-tooltip>
		<iron-a11y-keys id="a11y" target="[[keysTarget]]" keys="[[modifier.key]]+[[level]]" on-keys-pressed="execCommand"></iron-a11y-keys>
	</template>
	<script>
		Polymer(
			{
				is: 'wysiwyg-tool-heading',
				behaviors: [
					WYSIWYG.ToolBehavior
				],
				properties: {
					level: {
						type: Number,
						value: 1,
						observer: '_levelChanged'
					}
				},
				ready: function () {
					this._setCommand('formatBlock');
				},
				execCommand: function () {
					if (this.disabled || !this.range0) return false;

					if (!this.active) {
  				  if (this.commonAncestorPath) {
  					  for (var i = 0; i < this.commonAncestorPath.length; i += 1) {
  							if (['H1', 'H2', 'H3', 'H4', 'H4', 'H5', 'H6'].indexOf(this.commonAncestorPath[i].tagName) >= 0) {
  							  var heading = this.commonAncestorPath[i];
  							  var parent = heading.parentNode;
  							  this.range0.selectNodeContents(heading);
  							  parent.insertBefore(this.range0.extractContents(), heading);
  							  parent.removeChild(heading);
  							  break;
  							}
  						}
  				  }

						document.execCommand('formatBlock', null, 'H' + this.level);
					} else {
					  if (this.commonAncestorPath) {
  					  for (var i = 0; i < this.commonAncestorPath.length; i += 1) {
  							if (this.commonAncestorPath[i].tagName === 'H' + this.level) {
  							  var heading = this.commonAncestorPath[i];
  							  var parent = heading.parentNode;
  							  this.range0.selectNodeContents(heading);
  							  parent.insertBefore(this.range0.extractContents(), heading);
  							  parent.removeChild(heading);
  							  break;
  							}
  						}
  					} else {
						  document.execCommand('formatBlock', null, 'P');
  					}
					}
				},
				queryCommandState: function () {
					if (this.range0 && this.commonAncestorPath) {
					  for (var i = 0; i < this.commonAncestorPath.length; i += 1) {
							if (this.commonAncestorPath[i].tagName === 'H' + this.level) return true;
						}
					}

					return false;
				},
				_levelChanged: function () {
					if ([1, 2, 3, 4, 5, 6].indexOf(this.level) === -1) {
						this.level = 1;
					}
				}
			}
		);
	</script>
</dom-module>